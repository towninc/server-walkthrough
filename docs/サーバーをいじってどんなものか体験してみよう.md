
# 目次

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [サーバーとは](#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E3%81%AF)
  - [サーバーってなに？](#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB%EF%BC%9F)
  - [サーバー上での作業](#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E4%B8%8A%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD)
- [サーバーでの作業を体験しよう](#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD%E3%82%92%E4%BD%93%E9%A8%93%E3%81%97%E3%82%88%E3%81%86)
  - [サーバーへのログイン](#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%B8%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3)
  - [基本的なコマンド](#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89)
  - [管理者権限について](#%E7%AE%A1%E7%90%86%E8%80%85%E6%A8%A9%E9%99%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6)
  - [Linuxコマンドを自分で調べて実行してみよう](#linux%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E8%87%AA%E5%88%86%E3%81%A7%E8%AA%BF%E3%81%B9%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86)
  - [作業を早くするために](#%E4%BD%9C%E6%A5%AD%E3%82%92%E6%97%A9%E3%81%8F%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB)
- [課題](#%E8%AA%B2%E9%A1%8C)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# サーバーとは

## サーバーってなに？

サーバーとは、ネットワークを介して他のコンピュータに何らかの機能やデータを提供するコンピュータです。

物理的な構造は普通のPCとほとんど変わりませんが、
他のコンピュータに機能を提供するためのソフトウェアが入っています。


## サーバー上での作業

サーバーコンピュータは、サーバーソフトウェアや提供するデータが入っていなければただのコンピュータです。

サーバーとしてちゃんと機能させるためには、
サーバーにサーバーソフトウェアをインストールしたり、
提供するためのデータやアプリケーションを作成してサーバー上に設置する必要があります。

このような作業は基本的に、サーバーにログインして、サーバー上で行っていきます。

---

# サーバーでの作業を体験しよう

## サーバーへのログイン

PCからサーバーにログインするためにはSSHを利用します。

SSHとは、ネットワークを介して他のコンピュータにログインし、操作するための仕組みです。

Macでは「ターミナル」でSSHコマンドを入力することによって使うことができます。

### 準備

SSHでサーバーにログインするためには、通常のPCにログインするときと同じように、ユーザー名とパスワードが必要です。

今回はパスワードの代わりに「秘密鍵」というファイルを使うことでログインします。

まずはこの秘密鍵を用意しましょう。

Redmineのチケットに添付された「ci-training.pem」というファイルをダウンロードしてください。
ダウンロードができたら、ドックから「ターミナル」を起動して次の２つのコマンドを入力します。

```
mv ~/Downloads/ci-training.pem ~/
chmod 600 ~/ci-training.pem
```

これでサーバーに接続するための準備ができました。

### ログインしてみよう

それでは実際にサーバーにログインしてみましょう。

サーバーにログインするためには次のようなコマンドをターミナルで入力します。

```
ssh -i ~/ci-training.pem ec2-user@{サーバーのPublicIP}
```

このコマンドによって「{サーバーのPublicIP}」のIPアドレスを持ったサーバーに「ec2-user」というユーザーでログインすることができます。

Redmineのチケットに書いてあるサーバーのIPアドレスを「{サーバーのPublicIP}」の部分に入力してコマンドを実行してみましょう。

初回ログイン時は以下のようなメッセージが出るので、「yes」と入力してエンターを押します。

```
Are you sure you want to continue connecting (yes/no)?
```

ターミナルに以下のようなロゴが表示されたらログイン成功です！

```
 __|  __|_  )
 _|  (     /   Amazon Linux AMI
___|\___|___|
```

一見変わったようには見えませんが、これでサーバーにログインした状態になったので、コマンドでサーバーを操作することができます。

今回ログインしたサーバーには、Amazon LinuxというLinux系OSがインストールされています。

このOSはWindowsやMacとは異なり、基本的にコマンドを入力することによってのみ操作することができます。


## 基本的なコマンド

基本的なコマンドをいくつか使いながらサーバー上での操作を学んでいきましょう。


### pwd: 現在位置(カレントディレクトリ)を確認する

まずは、今自分がサーバー上のどこにいるのかを確認してみましょう。以下のコマンドを入力してください。

```
pwd
```

以下のように表示されたと思います。

```
/home/ec2-user
```

これが現在の自分のサーバー上での位置(カレントディレクトリ)を表しています。

homeというディレクトリ(フォルダ)の中にあるec2-userというフォルダの中にいることを表しています。

イメージとしては、WindowsのファイルエクスプローラーでCドライブ直下のhomeというフォルダの中のec2-userというフォルダを開いているような状態です。

### cd: 現在位置から移動する(カレントディレクトリを変更する)

今度は違うディレクトリに移動してみましょう。以下のコマンドを入力してください。

```
cd /var/log/
```

cdは違うディレクトリに移動するためのコマンドです。cdを実行した後にpwdを実行してみてください。カレントディレクトリが変更されているのが分かると思います。

cdコマンドを実行するときはコマンドの引数として移動先の場所(パス)を指定します。

パスの指定方法には絶対パスと相対パスとがあります。詳しくは以下のページを参考にしてみてください。

http://www.lpi.or.jp/column/linux/linux8.shtml

なお、cdコマンドを引数なしで実行すると、ホームディレクトリ(ログインしたときに最初にいるディレクトリ)に移動することができます。

一旦ホームディレクトリに戻っておきましょう。

```
cd
```

### touch: 空ファイルを作成する

ホームディレクトリに新しいファイルを作成してみます。

```
touch test.txt
```

これでカレントディレクトリにtest.txtというファイルを作成することができます。

### mkdir: ディレクトリを作成する

今度はホームディレクトリに新しいディレクトリ(フォルダ)を作成してみます。

```
mkdir test_dir
```

これでカレントディレクトリにtestというディレクトリを作成することができます。

### ls: ファイル・ディレクトリの一覧を表示する

先ほど作ったtest.txtとtestがちゃんと作れているのか確認してみましょう。

```
ls
```

lsコマンドはカレントディレクトリに存在するファイルやディレクトリを一覧表示します。

ファイル名だけだと寂しいので各ファイルの詳細情報も一覧表示してみましょう。

```
ls -l
```

「-l」をコマンドの「オプション」と呼びます。Linuxコマンドはオプションを指定することによって動作を少し変えることができます。

lsコマンドの場合は「-l」をつけることで詳細情報を表示するようになります。

詳しくは以下のページを参考にしてみてください。

http://webkaru.net/linux/ls-command/


### vim(vi): ファイルを編集する

([諸説ありますが](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E6%88%A6%E4%BA%89))一般的なPCでいうところの「メモ帳」にあたるものです。

とはいっても、使い方がとても独特・複雑怪奇で、使い方の説明だけで本が1冊書けるほどなので、
まずは、下記サイトを参考にして以下の作業の仕方を覚えてください。

* カーソル移動
* ファイル書き換え
* ファイル保存
* (書き換えせずに)強制終了

参考サイト:

* [Vimをメモ帳程度に使うために覚えておくべきコマンド - Qiita](http://qiita.com/honeniq/items/201156650310c4968c3a)
* [Vimの使い方 よく使うコマンドまとめ | Memo on the Web](http://motw.mods.jp/Vim/command.html)
* [viコマンド（vimコマンド）一覧（検索・置換）](http://uguisu.skr.jp/Windows/vi.html)

試しに、先ほどホームディレクトリに作った`test.txt`を適当に書き換えて保存してみましょう。

```
vim test.txt
```

### cat: ファイルの中身を表示

`cat`コマンドは、ファイルの中身をターミナル上に出力します。

試しに、先ほど書き換えた`test.txt`を出力してみましょう。

```
cat test.txt
```


### サーバーからログアウトしてみよう

サーバーからログアウトしてみましょう。

ターミナルに以下のコマンドを入力してください。

```
exit
```

以下のように表示されます。

```
logout
Connection to {サーバーのPublicIP} closed.
```

ログアウトできました。

## 管理者権限について

通常、SSHでログインできるユーザーは一般ユーザーで管理者権限を持っていません。

Linuxでは、サーバーにソフトウェアをインストールするといった作業は、管理者ユーザー(root)でなければ行えない仕組みになっています。

このような作業は以下のコマンドで一時的に管理者ユーザーになることで行います。

```
sudo su -
```

試しに、いくつかコマンドを実行してみましょう。
```
# ホームディレクトリが変わる
pwd
# つくったファイルの所有者がrootになる
touch /tmp/test_root.txt
ls -l /tmp/test_root.txt
```

管理者ユーザーから元のユーザーに戻るには以下のコマンドを実行します。

```
exit
```

今後のカリキュラムでは必要に応じて管理者ユーザーになって作業してください。


## Linuxコマンドを自分で調べて実行してみよう

このようにLinuxでは様々なコマンドによって操作していきます。

Linuxでの操作に慣れるためには、やりたいことを実現するコマンドを自分で調べていくことが一番の近道です。

練習として以下の操作を行うコマンドを調べて実行してみましょう。オプションや引数に注意してください。

* [ファイルを削除する](https://www.google.co.jp/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=linux+%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB+%E5%89%8A%E9%99%A4+%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89)
* [ディレクトリを削除する](https://www.google.co.jp/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=linux+%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA+%E5%89%8A%E9%99%A4+%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89)
* [ファイルの名前を変更する](https://www.google.co.jp/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=linux+%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D+%E5%A4%89%E6%9B%B4+%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89)
* [ファイルをコピーする](https://www.google.co.jp/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=linux%20%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%20%E3%82%B3%E3%83%94%E3%83%BC%20%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89)

今後のカリキュラムで分からないコマンドが出てきたら、
Googleなどの検索エンジンで調べて何をしているのか理解できるようにしましょう。

## 作業を早くするために

以下の記事で紹介されているLinuxの機能を扱いこなせると、作業のスピードが大幅に向上します。
今のうちに覚えておきましょう。

[仕事を10倍速くするコマンドライン操作Tips](http://heartbeats.jp/hbblog/2010/03/10tips.html)

* 以前のコマンドを呼び出す：`↑`または`Ctrl+p`
* 長いファイル名・コマンド名を自動補完: (入力途中で)`tab`
* 履歴探索：(入力途中で)`Ctrl+r`
* カーソル移動(先頭)：`Ctrl+a`
* カーソル移動(末尾)：`Ctrl+e`



---

# 課題

SSHでサーバに接続してから行ってください。

1. 管理者(root)権限で作った`/tmp/test_root.txt`を、管理者ではない`ec2-user`で削除してみましょう
    - 削除できたでしょうか？
    - どんなエラーが表示されるでしょうか
1. 次に、管理者(root)になって`/tmp/test_root.txt`を削除してみましょう
    - 削除できたでしょうか？
1. ホームディレクトリで`tab`キーによる自動補完を適当に試してみましょう
    - `ls test_(TABキー押下)`
    - 何が表示されましたか？
1. 続けて`Ctrl+r`や`↑キー`による履歴探索も適当に試してみましょう
    - `(Ctrl-r押下) ls`
    - 何が表示されましたか？
1. ホームディレクトリに作成したファイル(`test.txt`)、ディレクトリ(`test_dir`)を削除してみましょう
    - 削除コマンドを記入してください
